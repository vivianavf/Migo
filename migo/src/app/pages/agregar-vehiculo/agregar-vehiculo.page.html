<ion-toolbar>
  <ion-buttons slot="start">
    <ion-back-button *ngIf="whereFrom=='/vehiculos'"
      default-href="/vehiculos"
      text=""
      icon="chevron-back"
    ></ion-back-button>
    <ion-back-button *ngIf="whereFrom=='/formulario-aplicacion'"
      default-href="/formulario-aplicacion"
      text=""
      icon="chevron-back"
    ></ion-back-button>
  </ion-buttons>
  <ion-title>NUEVO VEHÍCULO</ion-title>
</ion-toolbar>

<app-ads></app-ads>

<ion-content class="withoutBackground">
  <ion-item-divider color="primary">
    <ion-title>Información del conductor</ion-title>
  </ion-item-divider>

  <form enctype="multipart/form-data">
    <div class="conductor-form aggVehiculoForm">
      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Nombre</ion-label>
        <ion-input
          class="addVehiculoInput rounded-input"
          [(ngModel)]="formFields.Nombre"
          name="Nombre"
          placeholder="Ingrese el nombre"
          required
          maxlength="30"
          pattern="^[a-zA-Z]+$"
          enterkeyhint="next"
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Apellido</ion-label>
        <ion-input
          class="addVehiculoInput rounded-input"
          [(ngModel)]="formFields.Apellido"
          name="Apellido"
          placeholder="Ingrese el apellido"
          required
          maxlength="30"
          pattern="^[a-zA-Z]+$"
          enterkeyhint="next"
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Cédula</ion-label>
        <ion-input
          class="addVehiculoInput rounded-input"
          [(ngModel)]="formFields.Cedula"
          name="Cedula"
          placeholder="Ingrese la cédula"
          required
          maxlength="10"
          pattern="^[0-9]+$"
          enterkeyhint="next"
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Fecha de Nacimiento</ion-label>
        <ion-input
          type="date"
          class="addVehiculoInput rounded-input"
          [(ngModel)]="formFields.FechaNacimiento"
          name="FechaNacimiento"
          placeholder="Fecha de Nacimiento"
          required
          maxlength="30"
          enterkeyhint="next"
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Sexo</ion-label>
        <ion-select
          part="select-sexo-vehiculo"
          class="never-flip rounded-input av-select"
          toggleIcon="caret-down-sharp"
          interface="popover"
          [(ngModel)]="formFields.Sexo"
          name="Sexo"
          placeholder="Seleccionar Sexo"
          required
        >
          <ion-select-option value="1">Masculino</ion-select-option>
          <ion-select-option value="2">Femenino</ion-select-option>
          <ion-select-option value="3">Prefiero No Decir</ion-select-option>
        </ion-select>
      </div>
    </div>

  <ion-item-divider color="primary">
      <ion-title>Información del vehículo</ion-title>
  </ion-item-divider>

    <div class="vehiculo-form aggVehiculoForm">
      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Placa</ion-label>
        <ion-input
          class="addVehiculoInput rounded-input"
          [(ngModel)]="formFields.Placa"
          name="Placa"
          placeholder="Ingrese la placa. Ejemplo: GXY1234"
          required
          maxlength="7"
          pattern="^[A-Z]{3}-[0-9]{4}$"
          enterkeyhint="next"
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Año</ion-label>
        <ion-input
          class="rounded-input addVehiculoInput"
          [(ngModel)]="formFields.anio"
          name="anio"
          placeholder="Ingrese el año"
          inputmode="numeric"
          maxlength="4"
          required
        ></ion-input>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Marca</ion-label>
        <ion-select
          part="select-marca-vehiculo"
          class="never-flip rounded-input av-select"
          toggleIcon="caret-down-sharp"
          interface="popover"
          [(ngModel)]="formFields.Marca"
          name="Marca"
          placeholder="Seleccionar marca"
          required
        >
          <ion-select-option
            *ngFor="let marca of valoresMarcas"
            value="{{ marca.id_marca }}"
            >{{ marca.nombre }}</ion-select-option
          >
        </ion-select>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Modelo</ion-label>
        <ion-select
          part="select-modelo-vehiculo"
          class="never-flip rounded-input av-select"
          toggleIcon="caret-down-sharp"
          interface="popover"
          [(ngModel)]="formFields.Modelo"
          name="Modelo"
          placeholder="Seleccionar modelo"
          required
        >
          <ion-select-option
            *ngFor="let modelo of valoresModelos"
            value="{{ modelo.id_modelo }}"
            >{{ modelo.nombre }}</ion-select-option
          >
        </ion-select>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Categoría</ion-label>
        <ion-select
          part="select-categoria-vehiculo"
          class="never-flip rounded-input av-select"
          toggleIcon="caret-down-sharp"
          interface="popover"
          [(ngModel)]="formFields.Categoria"
          name="Categoria"
          placeholder="Seleccionar categoría"
          required
        >
          <ion-select-option
            *ngFor="let categoria of categorias"
            value="{{categoria[0]}}"
            >{{categoria[1]}}</ion-select-option
          >
        </ion-select>
      </div>

      <div class="av-inputContainer">
        <ion-label class="av-inputLabel">Color</ion-label>
        <ion-select
          part="select-color-vehiculo"
          class="never-flip rounded-input av-select"
          toggleIcon="caret-down-sharp"
          interface="popover"
          [interfaceOptions]="{cssClass:'aggV-popover'}"
          [(ngModel)]="formFields.Color"
          name="Color"
          placeholder="Seleccionar color"
          required
        >
          <ion-select-option
            class="aggV-selectColor"
            *ngFor="let color of colores"
            value="{{color}}"
            >{{color}}</ion-select-option
          >
        </ion-select>
      </div>
    </div>

    <ion-item-divider color="primary">
      <ion-title>Fotos del vehículo</ion-title>
    </ion-item-divider>

    <div class="fotos-form"> 
      <div class="foto-laterales">
        <div class="button-container">
          <ion-label *ngIf="!fotoIzquierdaTomada">Lateral Izquierdo</ion-label>

          <ion-img
          class="fotoVehiculoPreview"
            *ngIf="fotoIzquierdaTomada"
            (click)="abrirModal()"
            src="{{srcIzquierda}}"
          ></ion-img>

          <ion-button
            *ngIf="!fotoIzquierdaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Izquierda')"
          >
            Tomar foto
          </ion-button>
          <ion-button
            *ngIf="fotoIzquierdaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Izquierda')"
          >
            Cambiar foto
          </ion-button>
        </div>

        <div class="button-container">
          <ion-label *ngIf="!fotoDerechaTomada">Lateral Derecho</ion-label>
          <ion-img
           class="fotoVehiculoPreview"
            *ngIf="fotoDerechaTomada"
            (click)="abrirModal()"
            src="{{srcDerecha}}"
          ></ion-img>
          <ion-button
            *ngIf="!fotoDerechaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Derecha')"
          >
            Tomar foto
          </ion-button>
          <ion-button
            *ngIf="fotoDerechaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Derecha')"
          >
            Cambiar foto
          </ion-button>
        </div>
      </div>

      <div class="foto-laterales">
        <div class="button-container">
          <ion-label *ngIf="!fotoTraseraTomada">Foto Trasera</ion-label>
          <ion-img
          class="fotoVehiculoPreview"
            (click)="abrirModal()"
            *ngIf="fotoTraseraTomada"
            src="{{srcTrasera}}"
          ></ion-img>
          <ion-button
            *ngIf="!fotoTraseraTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Trasera')"
          >
            Tomar foto
          </ion-button>
          <ion-button
            *ngIf="fotoTraseraTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Trasera')"
          >
            Cambiar foto
          </ion-button>
        </div>

        <div class="button-container">
          <ion-label *ngIf="!fotoAereaTomada">Foto Aérea</ion-label>
          <ion-img
          class="fotoVehiculoPreview"
            (click)="abrirModal()"
            *ngIf="fotoAereaTomada"
            src="{{srcAerea}}"
          ></ion-img>
          <ion-button
            *ngIf="!fotoAereaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Aerea')"
          >
            Tomar foto
          </ion-button>
          <ion-button
            *ngIf="fotoAereaTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Aerea')"
          >
            Cambiar foto
          </ion-button>
        </div>
      </div>

      <div class="foto-laterales">
        <div class="button-container">
          <ion-label *ngIf="!fotoFrontalTomada">Foto Frontal</ion-label>
          <ion-img
          class="fotoVehiculoPreview"
            (click)="abrirModal()"
            *ngIf="fotoFrontalTomada"
            src="{{srcFrontal}}"
          ></ion-img>
          <ion-button
            *ngIf="!fotoFrontalTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Frontal')"
          >
            Tomar foto
          </ion-button>
          <ion-button
            *ngIf="fotoFrontalTomada"
            expand="full"
            class="add_button"
            (click)="takePhoto('Frontal')"
          >
            Cambiar foto
          </ion-button>
        </div>
      </div>
    </div>

    <div *ngIf="showValidationError" class="validation-error datosincorrectos">
      {{ showValidationError }}
    </div>
    <ion-text *ngIf="esMayorEdad">Debe ser mayor a 18 años</ion-text>
    <div class="submit-button-container">
      <ion-button id="aggVehiculoButton" expand="default" (click)="submitForm()"
        >Agregar Vehículo</ion-button
      >
    </div>
  </form>


  <ion-modal
    *ngIf="missingFields.length === 0"
    trigger="aggVehiculoButton"
    class="aggVehiculoModal"
    [initialBreakpoint]="0.5"
    [breakpoints]="[0.5, 0.75]"
  >
  <ng-template>
    <ion-content>
      <div class="loadingContent">
        <ion-text>Enviando Solicitud...</ion-text>
        <ion-spinner class="loadingSpinner" name="dots" color="primary"></ion-spinner>
      </div>
    </ion-content>
  </ng-template>
  </ion-modal>
</ion-content>
